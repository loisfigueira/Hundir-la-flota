[2026-02-18 16:17:19] [INFO] [AppLogger] Logger inicializado (reseteado) en archivo: C:\Users\figue\Documents\Proyectos\PSP\Hundir la flota\composeApp\client.log
[2026-02-18 16:17:28] [INFO] [GameViewModel] Iniciando conexión para peruco a localhost:5678
[2026-02-18 16:17:28] [DEBUG] [GameClient] Intentando connectInternal a localhost:5678 para peruco
[2026-02-18 16:17:28] [INFO] [GameClient] Socket conectado. Iniciando recolección de mensajes y handshake.
[2026-02-18 16:17:28] [DEBUG] [GameClient] >>> ENVIANDO Handshake para: peruco
[2026-02-18 16:17:28] [DEBUG] [GameClient] >>> ENVIANDO: {"type":"connection_handshake","playerName":"peruco"}
[2026-02-18 16:17:28] [INFO] [GameClient] Conexión establecida y autenticada.
[2026-02-18 16:17:28] [DEBUG] [GameClient] >>> ENVIANDO: {"type":"system_ping","timestamp":1771427848434}
[2026-02-18 16:17:28] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"connection_welcome","playerId":"ddb8ae72-d84d-4647-9374-5ad0458d4428","serverVersion":"1.0.0","message":"Bienvenido a Hundir la Flota, peruco!"}
[2026-02-18 16:17:28] [INFO] [GameViewModel] Welcome recibido. MyPlayerId establecido a: 'ddb8ae72-d84d-4647-9374-5ad0458d4428'
[2026-02-18 16:17:28] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"stats_response","playerStats":{"playerName":"peruco","gamesPlayed":3,"gamesWon":3,"gamesLost":0,"pvpWon":1,"pveWon":2,"totalShots":172,"totalHits":90,"winStreak":3,"bestWinStreak":3,"averageAccuracy":52.32558139534884,"bestAccuracy":100.0,"fastestWinTurns":0,"totalPlayTimeSeconds":0},"leaderboard":[{"rank":1,"playerName":"peruco","gamesWon":3,"winRate":100.0,"bestStreak":3},{"rank":2,"playerName":"paco","gamesWon":0,"winRate":0.0,"bestStreak":0}]}
[2026-02-18 16:17:28] [INFO] [GameViewModel] Estadísticas recibidas. Actualizando Leaderboard y PlayerStats.
[2026-02-18 16:17:28] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"system_pong"}
[2026-02-18 16:17:28] [DEBUG] [GameViewModel] Ignorando mensaje Pong porque estamos en MainMenu
[2026-02-18 16:17:33] [INFO] [GameViewModel] Configuración actualizada: GameConfig(boardSize=8, turnTimeSeconds=60, maxRounds=1, shipsConfig=[ShipDefinition(type=CARRIER, count=1), ShipDefinition(type=BATTLESHIP, count=2), ShipDefinition(type=CRUISER, count=3), ShipDefinition(type=DESTROYER, count=4)])
[2026-02-18 16:17:33] [DEBUG] [GameViewModel] Navegando al Menú Principal. Ejecutando cleanup de partida.
[2026-02-18 16:17:36] [INFO] [GameViewModel] Iniciando partida PVE vs EASY. BoardSize=8, TurnTime=60, MaxRounds=1
[2026-02-18 16:17:36] [DEBUG] [GameClient] >>> ENVIANDO: {"type":"action_start_pve","config":{"boardSize":8},"difficulty":"EASY"}
[2026-02-18 16:17:36] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"matchmaking_found","gameId":"game_pve_1771427856064","opponentName":"Bot Hunter (EASY)","isPvE":true,"config":{"boardSize":8}}
[2026-02-18 16:17:36] [INFO] [GameViewModel] Match encontrado: game_pve_1771427856064 vs Bot Hunter (EASY)
[2026-02-18 16:17:36] [INFO] [GameViewModel] Configuración sincronizada con server: 8x8
[2026-02-18 16:17:36] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"response_game_state","phase":"PLACEMENT","currentTurn":"ddb8ae72-d84d-4647-9374-5ad0458d4428","turnTimeSeconds":60,"myBoard":{"cells":[["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"]],"ships":[]},"opponentBoard":{"cells":[["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"]]},"status":"Coloca tus barcos"}
[2026-02-18 16:17:47] [DEBUG] [GameViewModel] Confirmando despliegue de 10 barcos.
[2026-02-18 16:17:47] [DEBUG] [GameClient] >>> ENVIANDO: {"type":"action_confirm_deployment","ships":[{"type":"CARRIER","coordinate":{"x":1,"y":0},"orientation":"HORIZONTAL"},{"type":"BATTLESHIP","coordinate":{"x":2,"y":1},"orientation":"HORIZONTAL"},{"type":"BATTLESHIP","coordinate":{"x":2,"y":2},"orientation":"HORIZONTAL"},{"type":"CRUISER","coordinate":{"x":2,"y":5},"orientation":"HORIZONTAL"},{"type":"CRUISER","coordinate":{"x":5,"y":4},"orientation":"HORIZONTAL"},{"type":"CRUISER","coordinate":{"x":2,"y":3},"orientation":"HORIZONTAL"},{"type":"DESTROYER","coordinate":{"x":5,"y":3},"orientation":"HORIZONTAL"},{"type":"DESTROYER","coordinate":{"x":6,"y":2},"orientation":"HORIZONTAL"},{"type":"DESTROYER","coordinate":{"x":6,"y":1},"orientation":"HORIZONTAL"},{"type":"DESTROYER","coordinate":{"x":6,"y":0},"orientation":"HORIZONTAL"}]}
[2026-02-18 16:17:47] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"response_placement_confirmed","shipType":"BATTLESHIP"}
[2026-02-18 16:17:47] [DEBUG] [GameViewModel] Colocación confirmada: BATTLESHIP
[2026-02-18 16:17:47] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"response_game_start","gameId":"game_pve_1771427856064","opponentName":"Bot Hunter (EASY)","turnTimeSeconds":60}
[2026-02-18 16:17:47] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"response_game_state","phase":"BATTLE","currentTurn":"ddb8ae72-d84d-4647-9374-5ad0458d4428","turnTimeSeconds":60,"myBoard":{"cells":[["EMPTY","SHIP","SHIP","SHIP","SHIP","SHIP","SHIP","SHIP"],["EMPTY","EMPTY","SHIP","SHIP","SHIP","SHIP","SHIP","SHIP"],["EMPTY","EMPTY","SHIP","SHIP","SHIP","SHIP","SHIP","SHIP"],["EMPTY","EMPTY","SHIP","SHIP","SHIP","SHIP","SHIP","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","SHIP","SHIP","SHIP"],["EMPTY","EMPTY","SHIP","SHIP","SHIP","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"]],"ships":[{"type":"CARRIER","coordinates":[{"x":1,"y":0},{"x":2,"y":0},{"x":3,"y":0},{"x":4,"y":0},{"x":5,"y":0}],"sunk":false},{"type":"BATTLESHIP","coordinates":[{"x":2,"y":1},{"x":3,"y":1},{"x":4,"y":1},{"x":5,"y":1}],"sunk":false},{"type":"BATTLESHIP","coordinates":[{"x":2,"y":2},{"x":3,"y":2},{"x":4,"y":2},{"x":5,"y":2}],"sunk":false},{"type":"CRUISER","coordinates":[{"x":2,"y":5},{"x":3,"y":5},{"x":4,"y":5}],"sunk":false},{"type":"CRUISER","coordinates":[{"x":5,"y":4},{"x":6,"y":4},{"x":7,"y":4}],"sunk":false},{"type":"CRUISER","coordinates":[{"x":2,"y":3},{"x":3,"y":3},{"x":4,"y":3}],"sunk":false},{"type":"DESTROYER","coordinates":[{"x":5,"y":3},{"x":6,"y":3}],"sunk":false},{"type":"DESTROYER","coordinates":[{"x":6,"y":2},{"x":7,"y":2}],"sunk":false},{"type":"DESTROYER","coordinates":[{"x":6,"y":1},{"x":7,"y":1}],"sunk":false},{"type":"DESTROYER","coordinates":[{"x":6,"y":0},{"x":7,"y":0}],"sunk":false}]},"opponentBoard":{"cells":[["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"],["EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY","EMPTY"]]},"status":"Tu turno"}
[2026-02-18 16:17:47] [INFO] [GameViewModel] Cambiando UI a Battle
[2026-02-18 16:17:47] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"response_turn_update","playerId":"ddb8ae72-d84d-4647-9374-5ad0458d4428","secondsLeft":60}
[2026-02-18 16:17:48] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"response_turn_update","playerId":"ddb8ae72-d84d-4647-9374-5ad0458d4428","secondsLeft":59}
[2026-02-18 16:17:49] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"response_turn_update","playerId":"ddb8ae72-d84d-4647-9374-5ad0458d4428","secondsLeft":58}
[2026-02-18 16:17:50] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"response_turn_update","playerId":"ddb8ae72-d84d-4647-9374-5ad0458d4428","secondsLeft":57}
[2026-02-18 16:17:51] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"response_turn_update","playerId":"ddb8ae72-d84d-4647-9374-5ad0458d4428","secondsLeft":56}
[2026-02-18 16:17:52] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"response_turn_update","playerId":"ddb8ae72-d84d-4647-9374-5ad0458d4428","secondsLeft":55}
[2026-02-18 16:17:52] [INFO] [GameViewModel] Usuario solicita endSession(). Limpiando estado UI inmediatamente.
[2026-02-18 16:17:52] [DEBUG] [GameClient] >>> ENVIANDO: {"type":"action_leave_game"}
[2026-02-18 16:17:52] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"response_game_over","winnerId":"BOT_HUNTER_ID","stats":{"totalShots":0,"successfulHits":0,"shipsDestroyed":0,"accuracy":0.0,"winStreak":0}}
[2026-02-18 16:17:52] [DEBUG] [GameViewModel] Ignorando mensaje GameOver porque estamos en MainMenu
[2026-02-18 16:17:54] [DEBUG] [GameViewModel] Navegando a Records.
[2026-02-18 16:17:54] [DEBUG] [GameViewModel] Solicitando estadísticas.
[2026-02-18 16:17:54] [DEBUG] [GameClient] >>> ENVIANDO: {"type":"stats_request"}
[2026-02-18 16:17:54] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"stats_response","playerStats":{"playerName":"peruco","gamesPlayed":4,"gamesWon":3,"gamesLost":1,"pvpWon":1,"pveWon":2,"pveLost":1,"totalShots":172,"totalHits":90,"winStreak":0,"bestWinStreak":3,"averageAccuracy":52.32558139534884,"bestAccuracy":100.0,"fastestWinTurns":0,"totalPlayTimeSeconds":0},"leaderboard":[{"rank":1,"playerName":"peruco","gamesWon":3,"winRate":75.0,"bestStreak":3},{"rank":2,"playerName":"paco","gamesWon":0,"winRate":0.0,"bestStreak":0}]}
[2026-02-18 16:17:54] [INFO] [GameViewModel] Estadísticas recibidas. Actualizando Leaderboard y PlayerStats.
[2026-02-18 16:17:58] [DEBUG] [GameClient] >>> ENVIANDO: {"type":"system_ping","timestamp":1771427878440}
[2026-02-18 16:17:58] [DEBUG] [GameClient] <<< RECIBIDO: {"type":"system_pong"}
[2026-02-18 16:18:04] [DEBUG] [GameViewModel] Navegando al Menú Principal. Ejecutando cleanup de partida.
[2026-02-18 16:18:05] [INFO] [GameViewModel] Usuario solicitó desconexión.
[2026-02-18 16:18:05] [INFO] [GameClient] Desconectando...
[2026-02-18 16:18:05] [DEBUG] [GameClient] >>> ENVIANDO: {"type":"connection_disconnect"}
[2026-02-18 16:18:05] [ERROR] [GameClient] Error en Keep-Alive: StandaloneCoroutine was cancelled
kotlinx.coroutines.JobCancellationException: StandaloneCoroutine was cancelled; job=StandaloneCoroutine{Cancelling}@2ab8e96e
[2026-02-18 16:18:05] [ERROR] [GameClient] Excepción inesperada en message collection: StandaloneCoroutine was cancelled
kotlinx.coroutines.JobCancellationException: StandaloneCoroutine was cancelled; job=StandaloneCoroutine{Cancelling}@32ef1a2d
[2026-02-18 16:18:05] [INFO] [GameClient] Manejando desconexión inesperada.
